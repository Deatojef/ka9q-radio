\doxysection{/\+Users/karn/src/ka9q-\/radio/iir.h}
\hypertarget{iir_8h_source}{}\label{iir_8h_source}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Various\ simple\ IIR\ filters}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ 2022-\/2023,\ Phil\ Karn,\ KA9Q}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#ifndef\ \_IIR\_H}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#define\ \_IIR\_H\ 1}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#define\ \_GNU\_SOURCE\ 1}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <complex.h>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}misc.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}iir.h"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Experimental\ complex\ notch\ filter}}
\DoxyCodeLine{00013\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structnotchfilter}{notchfilter}}\ \{}
\DoxyCodeLine{00014\ \ \ complex\ \textcolor{keywordtype}{double}\ osc\_phase;\ \textcolor{comment}{//\ Phase\ of\ local\ complex\ mixer}}
\DoxyCodeLine{00015\ \ \ complex\ \textcolor{keywordtype}{double}\ osc\_step;\ \ \textcolor{comment}{//\ mixer\ phase\ increment\ (frequency)}}
\DoxyCodeLine{00016\ \ \ complex\ \textcolor{keywordtype}{float}\ dcstate;\ \ \ \ \textcolor{comment}{//\ Average\ signal\ at\ mixer\ frequency}}
\DoxyCodeLine{00017\ \ \ \textcolor{keywordtype}{float}\ bw;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Relative\ bandwidth\ of\ notch}}
\DoxyCodeLine{00018\ \};}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structnotchfilter}{notchfilter}}\ *notch\_create(\textcolor{keywordtype}{double},\textcolor{keywordtype}{float});}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#define\ notch\_delete(x)\ free(x)}}
\DoxyCodeLine{00023\ complex\ \textcolor{keywordtype}{float}\ notch(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structnotchfilter}{notchfilter}}\ *,complex\ \textcolor{keywordtype}{float});}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{comment}{//\ Goertzel\ state}}
\DoxyCodeLine{00026\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structgoertzel}{goertzel}}\ \{}
\DoxyCodeLine{00027\ \ \ \textcolor{keywordtype}{float}\ coeff;\ \textcolor{comment}{//\ 2\ *\ cos(2*pi*f/fs)\ =\ 2\ *\ creal(cf)}}
\DoxyCodeLine{00028\ \ \ complex\ \textcolor{keywordtype}{float}\ cf;\ \textcolor{comment}{//\ exp(-\/j*2*pi*f/fs)}}
\DoxyCodeLine{00029\ \ \ \textcolor{keywordtype}{float}\ s0,s1;\ \textcolor{comment}{//\ IIR\ filter\ state,\ s0\ is\ the\ most\ recent}}
\DoxyCodeLine{00030\ \};}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Initialize\ goertzel\ state\ to\ fractional\ frequency\ f}}
\DoxyCodeLine{00034\ \textcolor{keywordtype}{void}\ init\_goertzel(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structgoertzel}{goertzel}}\ *gp,\textcolor{keywordtype}{float}\ f);}
\DoxyCodeLine{00035\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ reset\_goertzel(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structgoertzel}{goertzel}}\ *gp)\{}
\DoxyCodeLine{00036\ \ \ gp-\/>s0\ =\ gp-\/>s1\ =\ 0;}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ update\_goertzel(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structgoertzel}{goertzel}}\ *gp,\textcolor{keywordtype}{float}\ x)\{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{float}\ s0save\ =\ gp-\/>s0;}
\DoxyCodeLine{00041\ \ \ gp-\/>s0\ =\ x\ +\ gp-\/>coeff\ *\ gp-\/>s0\ -\/\ gp-\/>s1;}
\DoxyCodeLine{00042\ \ \ gp-\/>s1\ =\ s0save;}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ complex\ \textcolor{keywordtype}{float}\ output\_goertzel(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structgoertzel}{goertzel}}\ *gp);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{comment}{//\ IIR\ filter\ operating\ on\ real\ data}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#define\ FILT\_ORDER\ 6}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{comment}{//\ Direct\ form\ II\ IIR\ data\ structure\ (single\ feedback\ array)}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ There's\ some\ confusion\ in\ the\ literature\ about\ notation}}
\DoxyCodeLine{00051\ \textcolor{comment}{//\ I\ use\ a[]\ for\ the\ poles\ (feedback)\ coefficients,\ b[]\ for\ the\ zeroes\ (feed\ forward)}}
\DoxyCodeLine{00052\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structiir}{iir}}\ \{}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordtype}{int}\ order;}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordtype}{double}\ a[FILT\_ORDER+1];\ \textcolor{comment}{//\ feedback\ coefficients\ (poles)}}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{double}\ b[FILT\_ORDER+1];\ \textcolor{comment}{//\ feedforward\ coefficients\ (zeroes)}}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{double}\ w[FILT\_ORDER+1];\ \textcolor{comment}{//\ filter\ state}}
\DoxyCodeLine{00057\ \};}
\DoxyCodeLine{00058\ \textcolor{keywordtype}{double}\ applyIIR(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structiir}{iir}}\ *,\textcolor{keywordtype}{double});}
\DoxyCodeLine{00059\ \textcolor{keywordtype}{void}\ setIIRnotch(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structiir}{iir}}\ *,\textcolor{keywordtype}{double});}
\DoxyCodeLine{00060\ \textcolor{keywordtype}{void}\ setIIRlp(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structiir}{iir}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structiir}{iir}},\textcolor{keywordtype}{double}\ f);}
\DoxyCodeLine{00061\ \textcolor{keywordtype}{void}\ setIIRdc(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structiir}{iir}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structiir}{iir}});}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
